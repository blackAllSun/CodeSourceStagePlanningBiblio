{# closingdays/index.html.twig #}

{% extends 'base.html.twig' %}

{% block page %}

  <div id='joursFeries'>
    <h3>Jours fériés et jours de fermeture</h3>
    <form name='form1' method='get' action='{{ asset("closingday") }}'>
      Sélectionnez l'année à paramétrer
      <select name='annee' onchange='document.form1.submit();'>
        <option value=''>&nbsp;</option>
        {% for y in years %}
          {% if y == selectedYear %}
            <option value={{y}} selected >{{ y }}</option>
          {% else %}
            <option value={{y}} >{{ y }}</option>
          {% endif%}
        {% endfor %}
      </select>
    </form>

    <!-- Tableau des jours fériés -->
    <form name='form' method='post' action='{{ asset("closingday") }}'>
      <input type='hidden' name='page' value='{{ asset("closingday") }}' />
      <input type='hidden' name='CSRFToken' value='{{ CSRFSession }}' />
      <input type='hidden' name='annee' value='{{ selectedYear }}' />
      <table cellspacing='0' id='closingTab'>
        <tr class='th'>
          <td>&nbsp;</td>
          <td>Jour</td>
          <td>Férié</td>
          <td>Fermeture</td>
          <td>Nom</td>
          <td>Commentaire</td>
        </tr>
        {% for d in days %}
          <tr id='tr{{ d.number }}'>
            <td>
              <a href='javascript:supprime_jourFerie({{ d.number }});'>
                <span class='pl-icon pl-icon-drop' title='Supprimer'></span>
              </a>
            </td>
            <td>
              <input type='text' name='jour[{{ d.number }}]' value={{ d.date }} class='c100 datepicker' id='jour{{ d.number }}'/>
            </td>
            {% if d.holiday == true %}
              <td>
                <input type='checkbox' name='ferie[{{ d.number }}]' value='1' checked />
              </td>
            {% else %}
              <td>
                <input type='checkbox' name='ferie[{{ d.number }}]' value='1' />
              </td>
            {% endif %}
            {% if d.closed == true %}
              <td>
                <input type='checkbox' name='fermeture[{{ d.number }}]' value='1' checked />
              </td>
            {% else %}
              <td>
                <input type='checkbox' name='fermeture[{{ d.number }}]' value='1' />
              </td>
            {% endif %}
            <td>
              <input type='text' name='nom[{{ d.number }}]' value='{{ d.name }}'  class='c350'/>
            </td>
            <td>
              <input type='text' name='commentaire[{{ d.number }}]' value='{{ d.comment }}'  class='c350'/>
            </td>
          </tr>
        {% endfor %}
        {% for j in nbDays..nbExtra %}
          <tr id='tr{{ j }}'>
            <td>
              <a href='javascript:supprime_jourFerie({{ j }});'>
                <span class='pl-icon pl-icon-drop' title='Supprimer'></span>
              </a>
            </td>
            <td>
              <input data-id="jour{{j}}" type='text' name="jour['{{ j }}']" class='c100 datepicker' id='{{ j }}'/>
            </td>
            <td>
              <input data-id="ferie{{j}}" type='checkbox' name="ferie['{{ j }}']" value='1' />
            </td>
            <td>
              <input data-id="fermeture{{j}}" type='checkbox' name="fermeture['{{ j }}']" value='1' />
            </td>
            <td>
              <input data-id="nom{{j}}" type='text' name="nom['{{ j }}']" class='c350'/>
            </td>
            <td>
              <input data-id="commentaire{{j}}" type='text' name="commentaire['{{ j }}']" class='c350'/>
            </td>
          </tr>
        {% endfor %}
        <tr id='last-line'></tr>
        <tr id="trButton">
          <td colspan='6' style='padding:20px 0 0 20px;'>
            <input type='submit' value='Valider' class='ui-button' />
            <input type='button' value='Ajouter' class='ui-button-add' />
          </td>
        </tr>
      </table>

    </form>
    {% if holiday_enable == true %}
      <p>Les jours de fermeture ne seront pas décomptés des congés.</p>
    {% endif %}
  </div>
<script type="text/javascript">
     $(document).ready(function(){
       $(".ui-button-add").on('click',function(){
        var trStart=$('#closingTab tr:last');
        var trPrev=trStart.prev('tr').prev('tr');
        console.log(trPrev);
        var trClone=trPrev.clone();
        console.log(trClone);
        var idLines=trClone.attr('id');
        console.log(idLines);
        var itemId = idLines.substring(2, idLines.length);
        console.log(itemId);
        var nextIdLine=parseInt(itemId)+1;
        trClone.attr('id','tr'+nextIdLine);

        var inputDayHoliday=trClone.find("a[href='javascript:supprime_jourFerie("+itemId+");']");
        inputDayHoliday.attr('href','javascript:supprime_jourFerie('+nextIdLine+');');

        var inputDay=trClone.find("input[data-id='jour"+itemId+"']");
        inputDay.attr("data-id","jour"+nextIdLine);
        inputDay.attr("id",nextIdLine);
        inputDay.attr("name","jour['"+nextIdLine+"']");
        inputDay.val('');

        var inputHoliday=trClone.find("input[data-id='ferie"+itemId+"']");
        inputHoliday.attr("data-id","ferie"+nextIdLine);
        inputHoliday.attr("name","ferie['"+nextIdLine+"']");
        inputHoliday.val('');

        var inputClosing=trClone.find("input[data-id='fermeture"+itemId+"']");
        inputClosing.attr("data-id","fermeture"+nextIdLine);
        inputClosing.attr("name","fermeture['"+nextIdLine+"']");
        inputClosing.val('');

        var inputName=trClone.find("input[data-id='nom"+itemId+"']");
        inputName.attr("data-id","nom"+nextIdLine);
        inputName.attr("name","nom['"+nextIdLine+"']");
        inputName.val('');

        var inputComment=trClone.find("input[data-id='commentaire"+itemId+"']");
        inputComment.attr("data-id","commentaire"+nextIdLine);
        inputComment.attr("name","commentaire['"+nextIdLine+"']");
        inputComment.val('');
        
        trClone.insertBefore('#last-line');

       });
       });
     </script>
{% endblock %}




